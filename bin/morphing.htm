<HTML>
<HEAD>
<TITLE>Морфинг</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=windows-1251" />
<LINK rel="stylesheet" href="css\style.css" type="text/css">
<SCRIPT src="script/buttonscript.js" language="JavaScript"></SCRIPT>
</HEAD>
<BODY>
<A name="begin"></A>
<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
<TR>
	<TD colspan="2">
	<!--часть шапка н-->
	<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
	<TR>
		<TD rowspan="2" bgcolor="#3B3B3B">
        	<P class="mainhead">
<!--Основной заголовок н-->
Программирование и внедрение нейросетей
<!--Основной заголовок к-->
			</P>
		</TD>
		<TD bgcolor="#3B3B3B" align="right" valign="top">
		<P class="t2">
<!--в шапке справа вверху н-->
<A href="search.htm" class="help"><IMG src="image/search_b.gif" width="16" height="16" border="0"> Поиск&nbsp;&nbsp;</A>
<A href="help.htm" class="help"><IMG src="image/question_b.gif" width="16" height="16" border="0"> Справка&nbsp;&nbsp;</A>

<!--в шапке справа вверху к-->
		</P>
		</TD>
	</TR>
	<TR>
		<TD bgcolor="#3B3B3B">
			<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
			<TR>
				<TD width="166" height="38"><IMG src="image/1.gif" width="166" height="38" border="0"></TD>
				<TD width="100%" height="38" background="image/2.gif"><IMG src="image/2.gif" width="1" height="38" border="0"></TD>
				<TD width="157" height="38"><IMG src="image/3.gif" width="157" height="38" border="0"></TD>
				<TD bgcolor="#6A6A6A">
					<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
					<TR>
						<TD width="100%" height="100%">
<!--в шапке маленькая надпись с права внизу н-->
<P class="t1">РГППУ</P>
<!--в шапке маленькая надпись с права внизу к-->
						<TD>
					</TR>
					<TR><TD width="100%" height="1" bgcolor="#3B3B3B"><IMG src="image/r1.gif" width="1" height="1" border="0"><TD></TR>
					</TABLE>
				</TD>
			</TR>
			</TABLE>
		</TD>
	</TR>
	<TR>
		<TD colspan="2" bgcolor="#626262"><IMG src="image/r2.gif" width="1" height="16" border="0"></TD>
	<TR>
	</TABLE>
	<!--часть шапка к-->
	</TD>
</TR>
<TR>
	<TD width="*" height="100%" bgcolor="#DFEDF6">
	<!--часть навигация н-->
	<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">

	<TR>
		<TD width="181" height="30"><IMG src="image/r3.gif" width="1" height="30" border="0"></TD>
		<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
	</TR>
<!--кнопки н-->
<!--
<TR>
	<TD width="181" height="30" background="image\b.gif" align="right" valign="middle">
	<P class="button_on"><NOBR>Начало</NOBR></P>
	</TD>
	<TD width="1" height="30" bgcolor="#FFFFFF"><IMG src="image/r5.gif" width="1" height="1" border="0"></TD>
</TR>
-->

<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="start.htm"><NOBR>Начало</NOBR></A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="create_proj.htm"><NOBR>Создание окна</NOBR></A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="cr_neronet.htm"><NOBR>Создание нейросети</NOBR></A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="initd3d.htm"><NOBR>Запуск Direct3D</NOBR></A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="crdelmod.htm"><NOBR>Визуализация</NOBR></A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" background="image\b.gif" align="right" valign="middle">
	<P class="button_on"><NOBR>Анимация</NOBR></P>
	</TD>
	<TD width="1" height="30" bgcolor="#FFFFFF"><IMG src="image/r5.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="kamera.htm">Камера</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="bma.htm">ВМА-файл</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="frommaxtox.htm">Экспорт модели</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="impl_neronet.htm">Внедрение нейросети</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle">
	<P class="button_on">&nbsp;</P>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="use_books.htm">Литература</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="ip.htm">Интерфейс пособия</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="metodukaz.htm">Методические указания</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="search.htm">Поиск по пособию</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<!--кнопки к-->
	<TR>
		<TD width="181" height="100%"><IMG src="image/r3.gif" width="1" height="1" border="0"></TD>
		<TD width="1" height="100%"  bgcolor="#DFEDF6" valign="top"><IMG src="image/9.gif" width="1" height="161" border="0"></TD>
	</TR>
	<TR>
		<TD width="182" height="1"><IMG src="image/r3.gif" width="182" height="1" border="0"></TD>
	</TR>
	</TABLE>
	<!--часть навигация к-->
	</TD>
	<TD width="100%" height="100%">
	<!--часть содержания н-->
	<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
	<TR>
		<TD align="justify" valign="top">
<!--содержание н-->

<TABLE cellspacing="5" cellpadding="0" border="0" width="*" height="*" align="center" style="margin-top:10px;">
	<TR>
		<TD><A href="anim.htm" class="wt">Анимация</A></TD>
		<TD><A href="morphing.htm" class="wt">Морфинг</A></TD>
		<TD><A href="cunit.htm" class="wt">Класс CUNIT</A></TD>
	</TR>
</TABLE>

<DIV class="layer_window">
<TABLE cellspacing="0" cellpadding="0" border="0" width="*" height="*" align="center" >
<TR>
	<TD width="5" height="23"><IMG src="image/5.gif" width="5" height="23" border="0"></TD>
	<TD width="*" height="23" background="image/4.gif">
		<TABLE cellspacing="0" cellpadding="0" border="0" width="*" height="*" align="center" >
		<TR>
			<TD width="100%" height="23" align="justify" valign="middle" >
<P class="head_window">Анимация</P>
			</TD>
			<TD width="63" height="23"><IMG src="image/mini_b.gif" width="63" height="23" border="0"></TD>
		</TR>
		</TABLE>
	</TD>
	<TD width="5" height="23"><IMG src="image/6.gif" width="5" height="23" border="0"></TD>
<TR>
<TR>
	<TD width="5" height="44" valign="bottom"><IMG src="image/7.gif" width="5" height="44" border="0"></TD>
	<TD height="100%" align="justify" valign="top">
<!--текст окошка н-->



<P class="title2">2. Морфинг</P> 
<P class="text">
Морфинг – это процесс изменения одной формы на другую. К примеру (Рис. 1), имеем два  меша (сеточный каркас или модель):
исходный и целевой. И если мы применим к данным мешам морфинг, то вершины исходного меша 
будут двигаться к вершинам целевого.
<P class="text">
Вы можете изменять интервал времени, используемый для отслеживания движения вершин 
из координат исходного меша в координаты целевого, при помощи скаляра (находящегося в диапазоне 
от 0 до 1). При значении скаляра равного 0, вершины будут расположены в исходном меше, в то 
время как при значении скаляра 1 вершины будут располагаться в целевом меше. Любое значение 
скаляра в промежутке от 0 до 1 расположит вершины между положением исходного и целевого меша.</P>
<P class="text">
Вычислить координаты расположения вершин между исходным и целевым мешами очень 
просто. Возьмите вершину исходного меша и умножьте её координаты на обратное значение скаляра 
(1.0 - scalar). Использование обратного значения скаляра означает, что координаты вершины будут 
определяться на 100 процентов координатами её в исходном меше при значении скаляра, установленного 
в 0, и на 0 процентов при скаляре, установленного в 1. Далее используя вершину, имеющею тот же самый 
индекс целевого меша, что и ранее, умножьте её координаты на значение скаляра. Сложив два получившихся 
значения, вы получите результирующие координаты вершины в сморфированной анимации. Сначала вся эта 
теория может показаться странной, но для уверенности можете выбрать заранее вычисленные координаты и 
применить к ним эту теорию и вы убедитесь, что все верно…
<P class="text">
Так же хочется акцентировать ваше внимание на основные правила морфинга:
<BR> 1) Каждый меш должен иметь одинаковое количество вершин;
<BR> 2) Каждой вершине исходного меша должна соответствовать вершина (точнее индекс вершины) в целевом меше;
<P class="text">
Порядок вершин является важным. Вершина, движущаяся из исходного меша, должна двигаться к вершине, имеющий 
тот же самый индекс в целевом меше. Иначе могут возникнуть совсем не предсказуемые результирующие меши, что, 
несомненно, испортит всю анимацию.<BR>
Посмотрите на рисунок 2 ниже:<BR><BR>
</P>
<CENTER><IMG height=289 alt="" src="image\examp\6.jpg" width=600 border=0 class="bo"> </CENTER>
<CENTER><P class="ris">Рис. 2</P></CENTER>
<P class="text">
<BR>
Каждый меш есть набор вершин типа CUSTOMVERTEX. Фактически меш можно представить как массив данных типа 
CUSTOMVERTEX. Но из рисунка 2 видно, что мешей много. Существуют последовательности - горизонтальные цепочки и
анимации - вертикальные. Всё это приводит к использованию трехмерного массива, где первый индекс - номер анимации, 
второй - номер последовательности, а третий номер - вершины.

<P class="text">
<B> Класс CANIMATION</B><BR>
Трехмерный массив данных, описанный выше, используется в классе CANIMATION, который служит для загрузки, хранения и вычисления меша.<BR>
Загрузка происходит по средствам метода LoadAnimationFF, единственным аргументом которого является путь к BMA-файлу.<BR>
Хранится весь набор анимаций в массиве CUSTOMVERTEX* morph_vertex[50][50], последняя часть которого (количество 
вершин) динамическая.
<P class="text">
Вычислить меш из morph_vertex возможно по средствам метода GetMorphedMesh, который имеет два параметра: 
первый - номер анимации, второй - скаляр. Но говорить, что второй аргумент метода скаляр не совсем корректно. 
Скаляр существует между двумя мешами и означает завершенность движения вершин от исходного меша к целевому 
в процентах. В нашем случае вернее говорить о 
позиции, которая означает завершенность анимации в процентах.<BR>
При использовании метода GetMorphedMesh будет вычислен меш, который запишеться в массив данных fruit_vertex типа 
CUSTOMVERTEX (результирующий меш).
<P class="text">
Для плавного перехода между анимациями (т.е. движение по вертикали) используется соединительный меш 
(conect_vertex). Обратите внимание на рисунок 3:</P>
<BR>
<CENTER><IMG height=259 alt="" src="image\examp\7.jpg" width=600 border=0 class="bo"></CENTER>
<CENTER><P class="ris">Рис. 3</P></CENTER>
<BR>
<P class="text">
Соединительный меш распологается как бы перед цепочкой последовательностей. И в выступает в роле 
первого меша цепочки. Метод GetMorphedMesh учитывает это, и если, к примеру, ввести в него номер какой-нибудь анимации, 
а далее позицию равную 0, то метод возвратит указатель на массив с информацией идентичной соединительному мешу. 
Соединительный меш можно задать используя метод ReWriteConectMesh, не имеющего никаких параметров. При его вызове произойдет 
совершенно банальная вещь - результирующий меш (fruit_vertex) скопируется в соединительный меш (conect_vertex).<BR>
Для более полного понимания данного процесса приведу пример: представьте, что проигрывается первая анимация на рисунке 3, 
где Бетти (девушка на картинке) прыгает. Вдруг! В самом пике прыжка (меш 5) происходит смена анимации прыжка
на анимацию бега. Чтобы сгладить переход на новую анимацию  приходиться в соединительный меш второй анимации (Бетти бежит) 
записать пятый меш первой анимации (Рис. 4).  
</P>
<BR>
<CENTER><IMG height="103" alt="" src="image\examp\8.jpg" width="600" border="0" class="bo"></CENTER>
<CENTER><P class="ris">Рис. 4</P></CENTER>
<BR>
<P class="text">
В результате получается морфинг как по горизонтали (между последовательностями) 
так и по вертикали (между анимациями) без прерываний!
</P>

<P class="title2">Вопросы для  самоконтроля</P>
<P class="text">
1)	Что такое морфинг?
<BR>2)	Назовите два основных правила морфинга?
<BR>3)	Для чего нужен класс CANIMATION?
<BR>4)	Что в себе хранит трехмерный массив morph_vertex типа CUSTOMVERTEX класса CANIMATION? И что означают его индексы?
<BR>5)	Каким образом можно загрузить меш из внешнего файла?
<BR>6)	Для чего нужно поле fruit_vertex класса CANIMATION?
<BR>7)	Какое поле класса CANIMATION позволяет сгладить переходы между анимациями?
<BR>8)	С помощью какой функции можно перезаписать связующий меш?
</P>

<P align="center">
<A class="wt" href="anim.htm" >назад</A>
<A class="wt" href="cunit.htm" >далее</A>
</P>



<!--текст окошка к-->
	<P align="right"><A href="#begin" class="wt">наверх</A></P><BR>
	</TD>
	<TD width="5" height="44" valign="bottom"><IMG src="image/8.gif" width="5" height="44" border="0"></TD>
</TR>
<TR>
	<TD width="5" height="1"><IMG src="image/r5.gif" width="5" height="1" border="0"></TD>
	<TD width="*" height="1" bgcolor="#CFDDF2"><IMG src="image/r6.gif" width="1" height="1" border="0"></TD>
	<TD width="5" height="1"><IMG src="image/r5.gif" width="5" height="1" border="0"></TD>
</TR>
</TABLE>
</DIV>
<P class="mini">MR, Кузнецов Алексей КТ-503, РГППУ, 2007г.</P>
<!--содержание к-->
		</TD>
	</TR>
	</TABLE>
	<!--часть содержания к-->
	</TD>
</TR>
<TR>
</TR>
</TABLE>
</BODY>
</HTML>