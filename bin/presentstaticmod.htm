<HTML>
<HEAD>
<TITLE>Презентация модели</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=windows-1251" />
<LINK rel="stylesheet" href="css\style.css" type="text/css">
<SCRIPT src="script/buttonscript.js" language="JavaScript"></SCRIPT>
</HEAD>
<BODY>
<A name="begin"></A>
<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
<TR>
	<TD colspan="2">
	<!--часть шапка н-->
	<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
	<TR>
		<TD rowspan="2" bgcolor="#3B3B3B">
        	<P class="mainhead">
<!--Основной заголовок н-->
Программирование и внедрение нейросетей
<!--Основной заголовок к-->
			</P>
		</TD>
		<TD bgcolor="#3B3B3B" align="right" valign="top">
		<P class="t2">
<!--в шапке справа вверху н-->
<A href="search.htm" class="help"><IMG src="image/search_b.gif" width="16" height="16" border="0"> Поиск&nbsp;&nbsp;</A>
<A href="help.htm" class="help"><IMG src="image/question_b.gif" width="16" height="16" border="0"> Справка&nbsp;&nbsp;</A>

<!--в шапке справа вверху к-->
		</P>
		</TD>
	</TR>
	<TR>
		<TD bgcolor="#3B3B3B">
			<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
			<TR>
				<TD width="166" height="38"><IMG src="image/1.gif" width="166" height="38" border="0"></TD>
				<TD width="100%" height="38" background="image/2.gif"><IMG src="image/2.gif" width="1" height="38" border="0"></TD>
				<TD width="157" height="38"><IMG src="image/3.gif" width="157" height="38" border="0"></TD>
				<TD bgcolor="#6A6A6A">
					<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
					<TR>
						<TD width="100%" height="100%">
<!--в шапке маленькая надпись с права внизу н-->
<P class="t1">РГППУ</P>
<!--в шапке маленькая надпись с права внизу к-->
						<TD>
					</TR>
					<TR><TD width="100%" height="1" bgcolor="#3B3B3B"><IMG src="image/r1.gif" width="1" height="1" border="0"><TD></TR>
					</TABLE>
				</TD>
			</TR>
			</TABLE>
		</TD>
	</TR>
	<TR>
		<TD colspan="2" bgcolor="#626262"><IMG src="image/r2.gif" width="1" height="16" border="0"></TD>
	<TR>
	</TABLE>
	<!--часть шапка к-->
	</TD>
</TR>
<TR>
	<TD width="*" height="100%" bgcolor="#DFEDF6">
	<!--часть навигация н-->
	<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">

	<TR>
		<TD width="181" height="30"><IMG src="image/r3.gif" width="1" height="30" border="0"></TD>
		<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
	</TR>
<!--кнопки н-->
<!--
<TR>
	<TD width="181" height="30" background="image\b.gif" align="right" valign="middle">
	<P class="button_on"><NOBR>Начало</NOBR></P>
	</TD>
	<TD width="1" height="30" bgcolor="#FFFFFF"><IMG src="image/r5.gif" width="1" height="1" border="0"></TD>
</TR>
-->

<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="start.htm"><NOBR>Начало</NOBR></A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="create_proj.htm"><NOBR>Создание окна</NOBR></A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="cr_neronet.htm"><NOBR>Создание нейросети</NOBR></A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="initd3d.htm"><NOBR>Запуск Direct3D</NOBR></A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" background="image\b.gif" align="right" valign="middle">
	<P class="button_on"><NOBR>Визуализация</NOBR></P>
	</TD>
	<TD width="1" height="30" bgcolor="#FFFFFF"><IMG src="image/r5.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="anim.htm">Анимация</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="kamera.htm">Камера</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="bma.htm">ВМА-файл</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="frommaxtox.htm">Экспорт модели</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="impl_neronet.htm">Внедрение нейросети</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle">
	<P class="button_on">&nbsp;</P>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="use_books.htm">Литература</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="ip.htm">Интерфейс пособия</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="metodukaz.htm">Методические указания</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="search.htm">Поиск по пособию</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<!--кнопки к-->
	<TR>
		<TD width="181" height="100%"><IMG src="image/r3.gif" width="1" height="1" border="0"></TD>
		<TD width="1" height="100%"  bgcolor="#DFEDF6" valign="top"><IMG src="image/9.gif" width="1" height="161" border="0"></TD>
	</TR>
	<TR>
		<TD width="182" height="1"><IMG src="image/r3.gif" width="182" height="1" border="0"></TD>
	</TR>
	</TABLE>
	<!--часть навигация к-->
	</TD>
	<TD width="100%" height="100%">
	<!--часть содержания н-->
	<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
	<TR>
		<TD align="justify" valign="top">
<!--содержание н-->

<TABLE cellspacing="5" cellpadding="0" border="0" width="*" height="*" align="center" style="margin-top:10px;">
	<TR>
		<TD><A href="crdelmod.htm" class="wt">Загрузка модели</A></TD>
		<TD><A href="presentstaticmod.htm" class="wt">Презентация модели</A></TD>
		<TD><A href="cenv.htm" class="wt">CENVIRONMENT</A></TD>

	</TR>
</TABLE>



<DIV class="layer_window">
<TABLE cellspacing="0" cellpadding="0" border="0" width="*" height="*" align="center" >
<TR>
	<TD width="5" height="23"><IMG src="image/5.gif" width="5" height="23" border="0"></TD>
	<TD width="*" height="23" background="image/4.gif">
		<TABLE cellspacing="0" cellpadding="0" border="0" width="*" height="*" align="center" >
		<TR>
			<TD width="100%" height="23" align="justify" valign="middle" >
<P class="head_window">Визуализация</P>
			</TD>
			<TD width="63" height="23"><IMG src="image/mini_b.gif" width="63" height="23" border="0"></TD>
		</TR>
		</TABLE>
	</TD>
	<TD width="5" height="23"><IMG src="image/6.gif" width="5" height="23" border="0"></TD>
<TR>
<TR>
	<TD width="5" height="44" valign="bottom"><IMG src="image/7.gif" width="5" height="44" border="0"></TD>
	<TD height="100%" align="justify" valign="top">
<!--текст окошка н-->



<P class="title2">2. Презентация модели</P>  
<P class="text">
И так, объекты, которые будут отображаться на сцене, уже созданы, информация о них загружена, инструменты отображения тоже готовы! Осталось самое главное – заставить видеокарту отобразить модель на экране, т.е. сформировать фрейм (кадр).
<BR>Для того чтобы отобразить кадр на сцене нужно:
<BR>1) Стереть все с экрана или той области, в которой будете рисовать;
<BR>2) Включить режим рисования кадра;
<BR>3) Переслать информацию о модели на видеокарту;
<BR>4) Отключить режим рисования;
<BR>5) Отобразить кадр на экране.</P>

<P class="text2">
<B>Задание 6</B><BR>
Для этого создайте функцию Rendering(), в которой будете заниматься построением фреймов (кадров),
запишисав ниже предложенный код:
<P class="kod">
void Rendering()<BR>
{<BR>
&nbsp;&nbsp;//тут идеть построение кадра<BR>
};
</P>

<P class="text2">
<B>Задание 7</B><BR>
Естественно, чтоб функция Rendering() работала нужно написать к ней обращение (вызов). Оно записывается в цикле 
обработки сообщений функции WinMain(). Сначало запишите обращение к функции Rendering() как 
указано ниже, а после разберем данную конструкцию подробнее:
</P>
<P class="kod">
while( msg.message!=WM_QUIT)<BR>
	{<BR>
		&nbsp;&nbsp;if(PeekMessage( &amp;msg, NULL,0,0,PM_REMOVE ))<BR>
		&nbsp;&nbsp;{<BR>
			&nbsp;&nbsp;&nbsp;&nbsp;TranslateMessage( &amp;msg );<BR>
			&nbsp;&nbsp;&nbsp;&nbsp;DispatchMessage( &amp;msg );<BR>
		&nbsp;&nbsp;}<BR>
		&nbsp;&nbsp;else<BR>
		&nbsp;&nbsp;{<FONT color="red">Rendering();</FONT>};<BR>
	};
</P>

<P class="text">
Вначале идет оператор цикла с предусловием, в котором проверяется прошлое пришедшее сообщение 
и сравнивается с сообщением WM_QUIT (выход). Если пришедшее сообщение <B>НЕ</B> WM_QUIT (выход), то 
выполняем цикл. Внутри цикла расположен условный оператор if. Условие истинно, когда функция 
извлечения вновь пришедших сообщений удачно провела извлечение (т.е. в очереди было какое то 
сообщение). Если условие истинно, то передаем управление функции MainWinProc(), иначе строим 
кадр по средствам вызова функции Rendering().

<P class="text2">
<B>Задание 8</B><BR>
Перейдите к коду функции рендеринг. Перепишите предложенный ниже код в операторные скобки функции Rendering():
</P>
<P class="kod">
if(D3DDevice == NULL)<BR>        
        return;<BR><BR>
	
//Установка точки обзора в нужное место<BR>
D3DXMATRIX matView; //матрица вида, хранящая расположение точки обзора<BR>
//Эта функция помогает создать матрицу вида<BR>
D3DXMatrixLookAtLH<BR>(<BR>&amp;matView,<BR>&amp;D3DXVECTOR3(500, 500, 500),<BR>&amp;D3DXVECTOR3(0, 0, 0),<BR>&amp;D3DXVECTOR3(0.0f, 0.0f, 1.0f)<BR>);<BR>
D3DDevice-&gt;SetTransform(D3DTS_VIEW, &amp;matView); //Регестрируете матрицу вида в системе<BR><BR>

//Стираете экран<BR>
D3DDevice-&gt;Clear<BR>(<BR> 0, NULL, D3DCLEAR_TARGET|D3DCLEAR_ZBUFFER,<BR> D3DCOLOR_XRGB(200,200,200), 1.0f, 0 <BR>);<BR>
//Включаете режим рисования кадра<BR>
D3DDevice-&gt;BeginScene();<BR><BR>
//Пересылаете информацию о модели на видеокарту (метод класса CENVIRONMENT)<BR>	
Model3D-&gt;Present();<BR><BR>
//Выключаете режим рисования кадра<BR>
D3DDevice-&gt;EndScene(); <BR> 
//Используете метод объекта видеокарты для рисования модели на экране монитора<BR>     
D3DDevice-&gt;Present( NULL, NULL, 0, NULL );<BR>
</P>

<P class="text">
Разберем данную конструкцию подробнее.<BR>
Вначале распологается условный оператор, с помощью которого проверяется наличие ссылки на объект видеокарты.
Если устройство потеряно (указатель = NULL) или не созданно вообще, то кадр не имеет смысла продолжать 
генерировать, т.к. у нас нет инструментов для его воспроизведению на экране.<BR>
Далее устанавливается точка обзора. Пока просто перепишите эти операторы. О них более подробно написано 
в главе "Камера".
<P class="text">
После установки точки обзора стирается экран и подготавливается к будущему кадру. Это делается с помощью 
метода объекта видеокарты Clear, который имеет следующие параметры:<BR>
<B>Первый параметр</B> - это номер массива 
            прямоугольников, подвергающихся очистке. Вы будете использовать 0 =
              
очистить всю память.<BR>
<B>Второй</B> - адрес массива прямоугольников. Поставте NULL = чистить всю область.<BR>
<B>Третий</B> - указывает, какие из поверхностей должны быть почищены. Укажите поверхность экрана и задний буфер 
(D3DCLEAR_TARGET|D3DCLEAR_ZBUFFER).<BR>
<B>Четвертый</B> - это цвет, в который закраситься поверхность экрана. Тут используется функция D3DCOLOR_XRGB (R, G, B), 
с помощью которой можно указав три параметра (красный, зеленый и синий) и получить указанный цвет в 
шестнадцатеричном виде.<BR>
<B>Последние два параметра</B> - это значение для Z-буфера и значение буфера трафарета соответственно. 
Перепишите их как есть.
<P class="text">
 Далее идет метод BeginScene(). Этот метод предназначен для указания системе о том, что дальше
пойдет передача информации из 
буферов (вершинных, текстурных, индексных...) на видеокарту. Саму эту передачу вы 
инициировали вызовом метода класса CENVIRONMENTModel3D-&gt;Present(). После передачи информации нужно оповестить систему о том, что действия 
такого рода завершены. Для этого вызывается метод объекта видеокарты EndScene(). 
<P class="text">
 После передачи нужной информации о сцене, вызывается метод объекта видеокарты, задачей которого
является сгенерировать кадр и показать его на экране монитора.(D3DDevice-&gt;Present( NULL, NULL, 0, NULL ) )
<P class="text">
Давайте более подробно рассмотрим метод класса CENVIRONMENT Present(). Вот его прототип:
</P>
<P class="kod">
HRESULT Present();
</P>
<P class="text">
Данный метод возвращает значение перечисляемого типа HRESULT, по которому можно судить об успешности его выполнения.
Параметров передавать данному методу никаких не требуется.<BR>
Метод Present() предназначен для:
<BR> - Передачи информации на видеокарту о позиции объекта относительно мировой системы координат. Данная информация хранится в 
следующих полях класса CENVIRONMENT:&nbsp;&nbsp;CUSTOMVERTEX Place.
<BR> - Передача информации о масштабе (размере) модели (float scale - размер модели (по умолчанию имеет значение 1 - размер "как есть")).
<BR> - Передача информации об углах поворота модели (float angx; float angy; float angz;).
<BR> - Применять ли свет на модель (если есть источник).
<BR> - Передача информации о текстуре модели о её меше...
<BR> - и т.п.

<P class="text2">
<B>Задание 9</B><BR>
Последний штрих. Теперь вам нужен внешний файл, содержащий информацию о модели. Возьмите его 
<A href="files\pauk1.zip" class="wt">здесь</A>
. Открыв его, вы увидите два файла Pauk1.bma - информация о меше и Pauk.jpg - текстура для модели. 
Поместите эти два файла в каталог Debug, т.е. туда, где расположен исполняемый файл вашего проекта.

<P class="text2">
<B>Задание 10</B><BR>
Откомпилируйте проект ошибок быть не должно. Если таковые возникли, то возьмите готовый 
<A href="files\static_model_3d.zip" class="wt">здесь</A>
 и найдите свою ошибку. Исправте ее.

<P class="text2">
<B>Задание 11</B><BR>
Запустите исполняемый файл. На экране должна появиться 3-х мерная модель робо-паука!!! <BR>
Сохраните проделанную вами работу.

<P class="text">
Теперь, осталось рассмотреть более подробно класс CENVIRONMENT.
</P>

<P class="title2">Вопросы для  самоконтроля</P>
<P class="text">
1)	Какие действия нужно сделать, чтобы отобразить сцену на экране?
<BR>2)	Какая функция поможет презентовать сцену на экране?
<BR>3)	А какая функция презентует модель на экране, загруженную из внешнего файла?
<BR>4)  Как вы думаете в чем различие методов Model3D->Present() и D3DDevice->Present()?
<BR>5)  С помошью какой фкнции можно очистить экран?
<BR>6)  Какие методы объекта видеокарты позволяют включать и отключать режим рисования кадра?
</P>

<P align="center">
<A href="crdelmod.htm" class="wt">назад</A>
<A href="cenv.htm" class="wt">далее</A>
</P>



<!--текст окошка к-->
	<P align="right"><A href="#begin" class="wt">наверх</A></P><BR>
	</TD>
	<TD width="5" height="44" valign="bottom"><IMG src="image/8.gif" width="5" height="44" border="0"></TD>
</TR>
<TR>
	<TD width="5" height="1"><IMG src="image/r5.gif" width="5" height="1" border="0"></TD>
	<TD width="*" height="1" bgcolor="#CFDDF2"><IMG src="image/r6.gif" width="1" height="1" border="0"></TD>
	<TD width="5" height="1"><IMG src="image/r5.gif" width="5" height="1" border="0"></TD>
</TR>
</TABLE>
</DIV>
<P class="mini">MR, Кузнецов Алексей КТ-503, РГППУ, 2007г.</P>
<!--содержание к-->
		</TD>
	</TR>
	</TABLE>
	<!--часть содержания к-->
	</TD>
</TR>
<TR>
</TR>
</TABLE>
</BODY>
</HTML>