<HTML>
<HEAD>
<TITLE>Загрузка модели</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=windows-1251" />
<LINK rel="stylesheet" href="css\style.css" type="text/css">
<SCRIPT src="script/buttonscript.js" language="JavaScript"></SCRIPT>
</HEAD>
<BODY>
<A name="begin"></A>
<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
<TR>
	<TD colspan="2">
	<!--часть шапка н-->
	<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
	<TR>
		<TD rowspan="2" bgcolor="#3B3B3B">
        	<P class="mainhead">
<!--Основной заголовок н-->
Программирование и внедрение нейросетей
<!--Основной заголовок к-->
			</P>
		</TD>
		<TD bgcolor="#3B3B3B" align="right" valign="top">
		<P class="t2">
<!--в шапке справа вверху н-->
<A href="search.htm" class="help"><IMG src="image/search_b.gif" width="16" height="16" border="0"> Поиск&nbsp;&nbsp;</A>
<A href="help.htm" class="help"><IMG src="image/question_b.gif" width="16" height="16" border="0"> Справка&nbsp;&nbsp;</A>

<!--в шапке справа вверху к-->
		</P>
		</TD>
	</TR>
	<TR>
		<TD bgcolor="#3B3B3B">
			<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
			<TR>
				<TD width="166" height="38"><IMG src="image/1.gif" width="166" height="38" border="0"></TD>
				<TD width="100%" height="38" background="image/2.gif"><IMG src="image/2.gif" width="1" height="38" border="0"></TD>
				<TD width="157" height="38"><IMG src="image/3.gif" width="157" height="38" border="0"></TD>
				<TD bgcolor="#6A6A6A">
					<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
					<TR>
						<TD width="100%" height="100%">
<!--в шапке маленькая надпись с права внизу н-->
<P class="t1">РГППУ</P>
<!--в шапке маленькая надпись с права внизу к-->
						<TD>
					</TR>
					<TR><TD width="100%" height="1" bgcolor="#3B3B3B"><IMG src="image/r1.gif" width="1" height="1" border="0"><TD></TR>
					</TABLE>
				</TD>
			</TR>
			</TABLE>
		</TD>
	</TR>
	<TR>
		<TD colspan="2" bgcolor="#626262"><IMG src="image/r2.gif" width="1" height="16" border="0"></TD>
	<TR>
	</TABLE>
	<!--часть шапка к-->
	</TD>
</TR>
<TR>
	<TD width="*" height="100%" bgcolor="#DFEDF6">
	<!--часть навигация н-->
	<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">

	<TR>
		<TD width="181" height="30"><IMG src="image/r3.gif" width="1" height="30" border="0"></TD>
		<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
	</TR>
<!--кнопки н-->
<!--
<TR>
	<TD width="181" height="30" background="image\b.gif" align="right" valign="middle">
	<P class="button_on"><NOBR>Начало</NOBR></P>
	</TD>
	<TD width="1" height="30" bgcolor="#FFFFFF"><IMG src="image/r5.gif" width="1" height="1" border="0"></TD>
</TR>
-->

<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="start.htm"><NOBR>Начало</NOBR></A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="create_proj.htm"><NOBR>Создание окна</NOBR></A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="cr_neronet.htm"><NOBR>Создание нейросети</NOBR></A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="initd3d.htm"><NOBR>Запуск Direct3D</NOBR></A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" background="image\b.gif" align="right" valign="middle">
	<P class="button_on"><NOBR>Визуализация</NOBR></P>
	</TD>
	<TD width="1" height="30" bgcolor="#FFFFFF"><IMG src="image/r5.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="anim.htm">Анимация</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="kamera.htm">Камера</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="bma.htm">ВМА-файл</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="frommaxtox.htm">Экспорт модели</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="impl_neronet.htm">Внедрение нейросети</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle">
	<P class="button_on">&nbsp;</P>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="use_books.htm">Литература</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="ip.htm">Интерфейс пособия</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="metodukaz.htm">Методические указания</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="search.htm">Поиск по пособию</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>

<!--кнопки к-->
	<TR>
		<TD width="181" height="100%"><IMG src="image/r3.gif" width="1" height="1" border="0"></TD>
		<TD width="1" height="100%"  bgcolor="#DFEDF6" valign="top"><IMG src="image/9.gif" width="1" height="161" border="0"></TD>
	</TR>
	<TR>
		<TD width="182" height="1"><IMG src="image/r3.gif" width="182" height="1" border="0"></TD>
	</TR>
	</TABLE>
	<!--часть навигация к-->
	</TD>
	<TD width="100%" height="100%">
	<!--часть содержания н-->
	<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
	<TR>
		<TD align="justify" valign="top">
<!--содержание н-->

<TABLE cellspacing="5" cellpadding="0" border="0" width="*" height="*" align="center" style="margin-top:10px;">
	<TR>
		<TD><A href="crdelmod.htm" class="wt">Загрузка модели</A></TD>
		<TD><A href="presentstaticmod.htm" class="wt">Презентация модели</A></TD>
		<TD><A href="cenv.htm" class="wt">CENVIRONMENT</A></TD>

	</TR>
</TABLE>



<DIV class="layer_window">
<TABLE cellspacing="0" cellpadding="0" border="0" width="*" height="*" align="center" >
<TR>
	<TD width="5" height="23"><IMG src="image/5.gif" width="5" height="23" border="0"></TD>
	<TD width="*" height="23" background="image/4.gif">
		<TABLE cellspacing="0" cellpadding="0" border="0" width="*" height="*" align="center" >
		<TR>
			<TD width="100%" height="23" align="justify" valign="middle" >
<P class="head_window">Визуализация</P>
			</TD>
			<TD width="63" height="23"><IMG src="image/mini_b.gif" width="63" height="23" border="0"></TD>
		</TR>
		</TABLE>
	</TD>
	<TD width="5" height="23"><IMG src="image/6.gif" width="5" height="23" border="0"></TD>
<TR>
<TR>
	<TD width="5" height="44" valign="bottom"><IMG src="image/7.gif" width="5" height="44" border="0"></TD>
	<TD height="100%" align="justify" valign="top">
<!--текст окошка н-->



<P class="title">Лабораторная работа №4</P>
<P class="title3">ВИЗУАЛИЗАЦИЯ СЦЕНЫ</P>

<P class="title2">В этой лабораторной работе вы научитесь:</P>
<P class="text">
1)	Работать с классом CENVIRONMENT.
<BR>2)	Загружать модели из внешнего файла.
<BR>3)	Презентовать загруженную модель на экране монитора.
<BR>4)	Анализировать работу методов класса CENVIRONMENT.
</P> 

<P class="title2">1. Загрузка модели</P>
<P class="text">И так, вы подошли к самой интересной главе учебного пособия! "Почему?" - вы спросите...
Потому что впервые сможете увидеть результаты своей работы виде красивого трехмерного объекта, плавно поворачивающегося вокруг своей оси.
<BR> В данной главе перед вами стоит задача визуализировать трехмерный объект на сцене.<BR> 
Для этого вам понадобится выполнить следующие шаги:
<BR>- Создание объекта класса CENVIRONMENT ;
<BR>- Загрузка объекта и текстуры из внешнего BMA-файла;
<BR>- Презентация модели на сцене;</P>

<P class="text2">
<B>Задание 1</B><BR>
Откройте свой проект, подготовленный в прошлых главах. После перейдите на главный документ D3DApplication.cpp.

<P class="text2">
<B>Задание 2</B><BR>
Создайте функцию с именем InitObgects в документе D3DApplication.cpp, записав ниже предложенный код выше 
функций WinMain() и MainWinProc(). В функции InitObgects будете инициализировать все объекты сцены.
Возвращать эта функция будет перечисляемый тип HRESULT:
<P class="kod">
HRESULT InitObjects()<BR>
{<BR>
&nbsp;&nbsp;//тут идет код инициализации объектов<BR><BR>
	
&nbsp;&nbsp;return S_OK;<BR>
};

<P class="text">
И вообще, все последующие функции, которые вы будете создавать, должны записываться выше этих двух функций, т.к. может 
случиться такая ситуация, при которой вы попытаетесь воспользоваться функцией, а компилятор не будет знать 
её объявление = возникнет ошибка.

<P class="text">
Обратите внимание! Вы создаете статическую модель, т.е. модель которая не предполагает 
изменение своей формы во времени. Если выделять абстракции из предметной области, которые бы подходили 
под данный тип, то я бы выделил, в первую очередь, небесный купол, поверхность земли, неподвижно 
ледащий камень на дороге и т.п.<BR>

<P class="text2">
<B>Задание 3</B><BR> 
Создайте объект данного класса в том же месте, где вы описывали объект гл. устройства и объект видеокарты.
<BR> Запишите:
<P class="kod">
CENVIRONMENT* Model3D = new CENVIRONMENT;
</P>

<P class="text">
Это место - место описания глобальных переменных, к которым можно обращаться из любого места проекта.

<P class="text">
Для того, чтобы загрузить из внешнего BMA-файла статическую модель нужно воспользоваться методом CreateModelFF 
класса CENVIRONMENT. Вот её прототип:
<P class="kod">
HRESULT CreateModelFF(char* passfile, LPDIRECT3DDEVICE9 Device);
</P>
<P class="text">
Метод CreateModelFF имеет следующие параметры:<BR>
- passfile - адрес BMA-файла;
<BR>- Device - указатель на объект видеокарты;<BR>
Данный метод возвращает перечисляемый тип HRESULT, по которому можно судить об успешности 
или не успешности загрузки модели.   
</P>

<P class="text2">
<B>Задание 4</B><BR>
Воспользуйтесь изученной функцией. 
Для этого в операторных скобках функции InitObjects() запишите следующее:  
<P class="kod">
HRESULT hRet = Model3D-&gt;CreateModelFF("Pauk1.bma", D3DDevice);<BR>	
if (FAILED(hRet)) {return hRet;};
</P>

<P class="text">
Обсудим данную конструкцию.<BR>
Вначале создается переменная hRet, в которой будет храниться возвращенное методом CreateModelFF значение типа HRESULT.
Далее тут же проводится инициализация, созданной переменной, непосредственно вызовом метода CreateModelFF. Но 
тут, конечно, не простая инициализация, т.к. метод CreateModelFF загружает модель из BMA-файла ("Pauk1.bma"), так же 
загружает текстуру, создает вершинные и текстурные буфера, используемые для хранения и передачи информации 
на видеокарту для последующей обработки и сохраняет ссылку на устройства отображения переданную в параметре 
D3DDevice. Далее идет условный попертор if, который проверяет на успешность 
выполнение загрузки модели по средствам анализа занчения переменной hRet. Анализ производиться с использованием 
функции FAILED(), которая аналогична функции SUCCEEDED(), изученной в прошлых главах, но с той лишь разницей,
что возвращает TRUE когда был неуспех. Отсюда конструкцию  if (FAILED(hRet)) {return hRet;}; можно интерпретировать так:
Если был не успех, то прекращается выполнение функции и возвращается значение hRet, иначе (т.е. если успех) функция 
продолжается выполняться дальше.<BR>
Вот и все! Совсем не сложно! Модель уже создана и готова к отображению на сцене...<BR>


<P class="text2">
<B>Задание 5</B><BR>
Но перед началом визуализации запишите код в функции DeleteObject() освобождения памяти для созданных объектов :  
</P>
<P class="kod">
if (Model3D != NULL) //если модель была создана<BR>&nbsp;&nbsp;Model3D-&gt;Release(); //удалим её
</P>

<P class="text">
Выше был использован метод Release(), который освобождает вас от головной боли по освобождению памяти системы
и сводит все к написанию одного слова.<BR>
Перейдем далее. 
</P>

<P class="title2">Вопросы для  самоконтроля</P>
<P class="text">
1)	Что позволяет имитировать класс CENVIRONMENT?
<BR>2)	Что позволяет сделать метод CreateModelFF?
<BR>3)	К какому классу принадлежит метод CreateModelFF?
<BR>4)	Какую информацию помогают анализировать функции SUCCEEDED() и FAILED()? В чем их отличие?
<BR>5)	Если объект класса CENVIRONMENT был создан, что следует ли его удалить по завершению приложения?

<P align="center">
<A href="presentstaticmod.htm" class="wt">далее</A>
</P>



<!--текст окошка к-->
	<P align="right"><A href="#begin" class="wt">наверх</A></P><BR>
	</TD>
	<TD width="5" height="44" valign="bottom"><IMG src="image/8.gif" width="5" height="44" border="0"></TD>
</TR>
<TR>
	<TD width="5" height="1"><IMG src="image/r5.gif" width="5" height="1" border="0"></TD>
	<TD width="*" height="1" bgcolor="#CFDDF2"><IMG src="image/r6.gif" width="1" height="1" border="0"></TD>
	<TD width="5" height="1"><IMG src="image/r5.gif" width="5" height="1" border="0"></TD>
</TR>
</TABLE>
</DIV>
<P class="mini">MR, Кузнецов Алексей КТ-503, РГППУ, 2007г.</P>
<!--содержание к-->
		</TD>
	</TR>
	</TABLE>
	<!--часть содержания к-->
	</TD>
</TR>
<TR>
</TR>
</TABLE>
</BODY>
</HTML>