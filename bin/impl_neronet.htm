<HTML>
<HEAD>
<TITLE>Подготовка</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=windows-1251" />
<LINK rel="stylesheet" href="css\style.css" type="text/css">
<SCRIPT src="script/buttonscript.js" language="JavaScript"></SCRIPT>
</HEAD>
<BODY>
<A name="begin"></A>
<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
<TR>
	<TD colspan="2">
	<!--часть шапка н-->
	<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
	<TR>
		<TD rowspan="2" bgcolor="#3B3B3B">
        	<P class="mainhead">
<!--Основной заголовок н-->
Программирование и внедрение нейросетей
<!--Основной заголовок к-->
			</P>
		</TD>
		<TD bgcolor="#3B3B3B" align="right" valign="top">
		<P class="t2">
<!--в шапке справа вверху н-->
<A href="search.htm" class="help"><IMG src="image/search_b.gif" width="16" height="16" border="0"> Поиск&nbsp;&nbsp;</A>
<A href="help.htm" class="help"><IMG src="image/question_b.gif" width="16" height="16" border="0"> Справка&nbsp;&nbsp;</A>

<!--в шапке справа вверху к-->
		</P>
		</TD>
	</TR>
	<TR>
		<TD bgcolor="#3B3B3B">
			<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
			<TR>
				<TD width="166" height="38"><IMG src="image/1.gif" width="166" height="38" border="0"></TD>
				<TD width="100%" height="38" background="image/2.gif"><IMG src="image/2.gif" width="1" height="38" border="0"></TD>
				<TD width="157" height="38"><IMG src="image/3.gif" width="157" height="38" border="0"></TD>
				<TD bgcolor="#6A6A6A">
					<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
					<TR>
						<TD width="100%" height="100%">
<!--в шапке маленькая надпись с права внизу н-->
<P class="t1">РГППУ</P>
<!--в шапке маленькая надпись с права внизу к-->
						<TD>
					</TR>
					<TR><TD width="100%" height="1" bgcolor="#3B3B3B"><IMG src="image/r1.gif" width="1" height="1" border="0"><TD></TR>
					</TABLE>
				</TD>
			</TR>
			</TABLE>
		</TD>
	</TR>
	<TR>
		<TD colspan="2" bgcolor="#626262"><IMG src="image/r2.gif" width="1" height="16" border="0"></TD>
	<TR>
	</TABLE>
	<!--часть шапка к-->
	</TD>
</TR>
<TR>
	<TD width="*" height="100%" bgcolor="#DFEDF6">
	<!--часть навигация н-->
	<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">

	<TR>
		<TD width="181" height="30"><IMG src="image/r3.gif" width="1" height="30" border="0"></TD>
		<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
	</TR>
<!--кнопки н-->
<!--
<TR>
	<TD width="181" height="30" background="image\b.gif" align="right" valign="middle">
	<P class="button_on"><NOBR>Начало</NOBR></P>
	</TD>
	<TD width="1" height="30" bgcolor="#FFFFFF"><IMG src="image/r5.gif" width="1" height="1" border="0"></TD>
</TR>
-->

<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="start.htm"><NOBR>Начало</NOBR></A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="create_proj.htm"><NOBR>Создание окна</NOBR></A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="cr_neronet.htm"><NOBR>Создание нейросети</NOBR></A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="initd3d.htm"><NOBR>Запуск Direct3D</NOBR></A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="crdelmod.htm"><NOBR>Визуализация</NOBR></A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="anim.htm">Анимация</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="kamera.htm">Камера</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="bma.htm">ВМА-файл</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="frommaxtox.htm">Экспорт модели</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" background="image\b.gif" align="right" valign="middle">
	<P class="button_on"><NOBR>Внедрение нейросети</NOBR></P>
	</TD>
	<TD width="1" height="30" bgcolor="#FFFFFF"><IMG src="image/r5.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle">
	<P class="button_on">&nbsp;</P>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="use_books.htm">Литература</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="ip.htm">Интерфейс пособия</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="metodukaz.htm">Методические указания</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="search.htm">Поиск по пособию</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>

<!--кнопки к-->
	<TR>
		<TD width="181" height="100%"><IMG src="image/r3.gif" width="1" height="1" border="0"></TD>
		<TD width="1" height="100%"  bgcolor="#DFEDF6" valign="top"><IMG src="image/9.gif" width="1" height="161" border="0"></TD>
	</TR>
	<TR>
		<TD width="182" height="1"><IMG src="image/r3.gif" width="182" height="1" border="0"></TD>
	</TR>
	</TABLE>
	<!--часть навигация к-->
	</TD>
	<TD width="100%" height="100%">
	<!--часть содержания н-->
	<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
	<TR>
		<TD align="justify" valign="top">
<!--содержание н-->


<TABLE cellspacing="5" cellpadding="0" border="0" width="*" height="*" align="center" style="margin-top:10px;">
	<TR>
		<TD><A href="impl_neronet.htm" class="wt">Подготовка</A></TD>
		<TD><A href="create_world.htm" class="wt">Создание мира</A></TD>
		<TD><A href="impl.htm" class="wt">Внедрение нейросети</A></TD>	
	</TR>
</TABLE>



<DIV class="layer_window">
<TABLE cellspacing="0" cellpadding="0" border="0" width="*" height="*" align="center" >
<TR>
	<TD width="5" height="23"><IMG src="image/5.gif" width="5" height="23" border="0"></TD>
	<TD width="*" height="23" background="image/4.gif">
		<TABLE cellspacing="0" cellpadding="0" border="0" width="*" height="*" align="center" >
		<TR>
			<TD width="100%" height="23" align="justify" valign="middle" >
<P class="head_window">Внедрение нейросети</P>
			</TD>
			<TD width="63" height="23"><IMG src="image/mini_b.gif" width="63" height="23" border="0"></TD>
		</TR>
		</TABLE>
	</TD>
	<TD width="5" height="23"><IMG src="image/6.gif" width="5" height="23" border="0"></TD>
<TR>
<TR>
	<TD width="5" height="44" valign="bottom"><IMG src="image/7.gif" width="5" height="44" border="0"></TD>
	<TD height="100%" align="justify" valign="top">
<!--текст окошка н-->

<P class="title">Лабораторная работа №9</P>
<P class="title3">Внедрение нейросети</P>

<P class="title2">В этой лабораторной работе вы научитесь:</P>
<P class="text">
1) Моделировать окружающую среду.
<BR>2) Внедрять нейросеть сеть в моделируемую среду.

					
<P class="title2">1. Подготовка для внедрения нейросети.</P> 
<P class="text">
Внедрение нейросети требует чательной подготовки. Конкретных, унифицированных этапов подготовки не 
существует – все зависит от конкретного проекта, впрочем, как и наличие самой подготовки. 
<P class="text">
Данная подготовка будет состоять из трех этапов:
<BR>1.	<B>Экспорт нейросети</B> из проектов созданных в прошлых лабораторных работах в данный проект.
<BR>2.	<B>Модернизация функции Rendering.</B> Данная модернизация связана с тем, что проект после создания 
будет запускаться на компьютерах с разной производительностью. И в связи с этим скорость анимации может 
быть разная. От этого можно избавиться используя внутреннее время ОС Windows, которая в миллисекундах 
считает время, начиная с начала своей работы. Вся модернизация заключается в том, что вы заставляете 
программу генерировать новый кадр в функции Rendering() только в том случае, если после последней 
генерации кадра прошло более 24 миллисекунд.
<BR>3.	<B>Изменение работы камеры</B> для улучшения обзора сцены.

<P class="text">
<B>Экспорт нейросети.</B><BR>
Весь экспорт заключается в банальном копировании кода из проекта созданного в прошлой лабораторной 
работе в создаваемый проект.

<P class="text2">
<B>Задание 1</B><BR>
Откройте 
<A href="files\set_anim.zip" class="wt">проект </A>
сделанный в лабораторной работе "Анимация".

<P class="text2">
<B>Задание 2</B><BR>
Подключите классы для работы с нейросетью так, как вы это делали в лабораторной работе "
<A href="cr_neronet.htm" class="wt">Создание нейросети</A>
".

<P class="text2">
<B>Задание 3</B><BR>
Перенесите (копируя код) функцию NeroNet(), из проекта сделанного во второй части ("Обучение неросети") 
лабораторной работы "Создание нейросети", в ваш проект и переименуйте ее в InitNeroNet().<BR>
Не забудьте добавить вызов данной функции в WinMain(), аналогично тому, как это происходило с 
функцией NeroNet() в лабораторной работе "Создание нейросети".

<P class="text2">
<B>Задание 4</B><BR>
Удалите из функции InitNeroNet() код создания и удаления объекта класса NERO_NET
(NERO_NET* net = new NERO_NET(2,3,2,2);  и  net->~NERO_NET();), т.к. далеевам понадобится глобальная 
переменная отвечающая за объект нейросети, а не локальная как это было тут.

<P class="text2">
<B>Задание 5</B><BR>
А вот сейчас добавьте глобальный объект класса  NERO_NET (объект нейросети), записав приведенный ниже 
код в самом верху, там, где описываются все переменные уже на протяжении 8 лабораторных работ:
<P class="kod">
NERO_NET* net = new NERO_NET(2,3,2,2);

<P class="text2">
<B>Задание 6</B><BR>
Естественно, что создав объект сети, его нужно где-то удалять. Сделать это нужно в специально отведенном 
месте – в функции DeleteObject(), записав в самом верху операторных скобок данной функции следующее:
<P class="kod">
net->~NERO_NET();

<P class="text">
<B>Модернизация функции Rendering.</B><BR>
Как уже писалось выше, функцию Rendering нужно немного модифицировать, так чтобы генерация кадра происходила 
не менее чем через 24 миллисекунды. Тем самым вы сможете сделать так, чтобы на компьютерах с разной 
производительностью скорость анимации была примерно одинаковой.

<P class="text2">
<B>Задание 7</B><BR>
Добавьте библиотеку работы со временем time.h, записав ниже приведенный код рядом с кодом подключения классов MRCD9
(#include <MRCD9.H>): 
<P class="kod">
#include <time.h>

<P class="text2">
<B>Задание 8</B><BR>
Добавьте переменные чуть ниже подключения библиотеки time.h для того, чтобы запоминать прошлое время(LastTime) и 
разницу между настоящим временем и прошлым (ElapsedTime). Замете, что для инициализации переменной переменной 
LastTime используется функция timeGetTime()  библиотеки time.h, которая после своего вызова возвращает системное время 
отсчитываемое с последнего запуска ОС Windows в миллисекундах. Тип данных, возвращаемый данной функцией DWORD 
(что-то типа float), поэтому и переменные должны быть этого типа или совместимого с ним: 
<P class="kod">
DWORD LastTime = timeGetTime();<BR>
DWORD ElapsedTime=0;

<P class="text2">
<B>Задание 9</B><BR>
Осталось только создать условие, которое будет проверять сколько прошло миллисекунд с последней генерации кадра, 
для этого запишите поле 
<P class="kod">
if(D3DDevice == NULL)<BR>        
&nbsp;&nbsp;&nbsp;return;
<P class="text2">
следующее
<P class="kod">
ElapsedTime=timeGetTime()-LastTime;<BR>
if (ElapsedTime>=24)<BR>
{<BR>
&nbsp;&nbsp;&nbsp;//запоминаем время<BR>
&nbsp;&nbsp;&nbsp;LastTime=timeGetTime();<BR>
<BR>
&nbsp;&nbsp;&nbsp;//тут генерим кадр<BR>
}

<P class="text2">
<B>Задание 10</B><BR>
И последнее, перенесите весь код функции Rendering, который ниже только что созданного вами условия, 
вместо комментария «//тут генерим кадр» внутри операторных скобок данного условия.


<P class="text">
<B>Изменение работы камеры.</B><BR>
Изменение работы камеры предполагает качественное улучшение, которое дает больше возможностей для 
обзора сцены.
<P class="text">
Первое что нужно сделать это удалить старый код, предназначенный для обработки события нажатия пробела
 для смены анимации модели. 

<P class="text2">
<B>Задание 11</B><BR>
Для этого удалите создание следующей переменной:
<P class="kod">
int n_animation=0;

<P class="text2">
<B>Задание 12</B><BR>
Затем удалите все (т.е. код обработки нажатия пробела), что находится в операторных скобках case в функции MainWinProc.
У вас должно получиться так:
<P class="kod">
case WM_KEYDOWN:<BR>
{<BR>
&nbsp;&nbsp;&nbsp;//тут все удалили<BR>
<BR>	
&nbsp;&nbsp;&nbsp;break;<BR>
};

<P class="text">
Для запоминания таких параметром камеры, как местоположение (camera_place_X, camera_place_Y, camera_place_Z), 
угол поворота (camera_ang) и удаленность от точки наблюдения (camera_dist), вам понадобятся дополнительные переменные.
Так же понадобиться еще и переменная, хранящая матрицу вида. О ней мы подробно говорили в лабораторной работе "Камера".

<P class="text2">
<B>Задание 13</B><BR>
Данные переменные приведены ниже. Добавьте их в свой проект туда же, куда вы вписывали все глобальные 
переменные (самый верх). 
<P class="kod">
//камера<BR>
float camera_place_X=0, camera_place_Y=0, camera_place_Z=0;<BR>
float camera_ang=0;<BR>
float camera_dist=2500;<BR>
D3DXMATRIX matView;<BR>

<P class="text2">
<B>Задание 14</B><BR>
В оператор case функции MainWinProc добавьте следующий код, приведенный ниже и попробуйте в нем разобраться 
самостоятельно, т.к. никаких новшеств в нем нет:
<P class="kod">

			 if (wparam == VK_ESCAPE) {PostQuitMessage(0);return 0;};<BR>
			 if (wparam == VK_RIGHT) {if (camera_ang>=0) {camera_ang-=10;} else {camera_ang=350;};};<BR>
			 if (wparam == VK_LEFT) {if (camera_ang<=350) {camera_ang+=10;} else {camera_ang=0;};};<BR>
			 if (wparam == VK_UP) <BR>
			 {<BR>
				 &nbsp;&nbsp;&nbsp;camera_place_X=(float)(-15*cos(D3DXToRadian(camera_ang))+camera_place_X);<BR>
				 &nbsp;&nbsp;&nbsp;camera_place_Y=(float)(-15*sin(D3DXToRadian(camera_ang))+camera_place_Y);<BR>
				
			 };<BR>
			 if (wparam == VK_DOWN) <BR>
			 {<BR>
				 &nbsp;&nbsp;&nbsp;camera_place_X=(float)(15*cos(D3DXToRadian(camera_ang))+camera_place_X);<BR>
				 &nbsp;&nbsp;&nbsp;camera_place_Y=(float)(15*sin(D3DXToRadian(camera_ang))+camera_place_Y);<BR>
				
			 };<BR>
			 if (wparam == VK_PRIOR) {if (camera_dist<=3000) {camera_dist+=10;};};<BR>
			 if (wparam == VK_NEXT) {if (camera_dist>=300) {camera_dist-=10;};};<BR>


<P class="text2">
<B>Задание 15</B><BR>
И последний штрих – измените код обработки камеры с
<P class="kod"> 
	//Камера<BR>
	D3DXMATRIX matView;<BR>
	D3DXMatrixLookAtLH(&matView, &D3DXVECTOR3(500, 500, 500), &D3DXVECTOR3(0, 0, 0), &D3DXVECTOR3(0.0f, 0.0f, 1.0f));<BR>
	D3DDevice->SetTransform(D3DTS_VIEW, &matView);<BR>
<P class="text2">
на
<P class="kod">
//Матрица вида (камера)<BR>
D3DXVECTOR3 Cam_Pos = D3DXVECTOR3(camera_dist*cos(D3DXToRadian(camera_ang))+camera_place_X,<BR> 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;camera_dist*sin(D3DXToRadian(camera_ang))+camera_place_Y, camera_dist);<BR>
D3DXVECTOR3 Cam_Look_To = D3DXVECTOR3(camera_place_X, camera_place_Y, camera_place_Z);<BR>
D3DXMatrixLookAtLH(&matView, &Cam_Pos, &Cam_Look_To, &D3DXVECTOR3(0.0f, 0.0f, 1.0f));<BR>
D3DDevice->SetTransform(D3DTS_VIEW, &matView);<BR>


<P class="text2">
<B>Задание 16</B><BR>
Сохраните и откомпилируйте проект, затем запустите получившийся исполняемый файл. Оцените результат. 

<P class="text">
Как видите есть один недочет – модель крутиться вокруг своей оси.

<P class="text2">
<B>Задание 17</B><BR>
Удалите в функции Rendering следующий код, отвечающий за вращение модели:
<P class="kod">
if (Model3D->rotate<=359) {Model3D->rotate+=1;}<BR>
	else {Model3D->rotate = 0;};


<P class="text2">
<B>Задание 18</B><BR>
Запустите проект снова. Ошибок быть не должно… Если таковые имеются и вы не знаете как их решить, 
то вам поможет готовый 
<A href="files\podgotovka.zip" class="wt">проект</A>
. Изучите его и постарайтесь исправить свои ошибки.

<P class="title2">Вопросы для  самоконтроля</P>
<P class="text">
1) Для чего нужна функция timeGetTime() и что она возвращает при своем вызове?
<BR>2) В чем заключалась суть модернизации функции Rendering?
<BR>3) Каким образом можно вычислить координаты точки на плоскости, зная расстояние от начала координат и угол поворота вокруг оси Z?
<BR>4) Укажите задания в данной лабораторной работе, в которых применялся подход вычиления координат из известного угла и расстояни до начала координат?



<P align="center">
<A href="create_world.htm" class="wt">далее</A>
</P>

<!--текст окошка к-->
	<P align="right"><A href="#begin" class="wt">наверх</A></P><BR>
	</TD>
	<TD width="5" height="44" valign="bottom"><IMG src="image/8.gif" width="5" height="44" border="0"></TD>
</TR>
<TR>
	<TD width="5" height="1"><IMG src="image/r5.gif" width="5" height="1" border="0"></TD>
	<TD width="*" height="1" bgcolor="#CFDDF2"><IMG src="image/r6.gif" width="1" height="1" border="0"></TD>
	<TD width="5" height="1"><IMG src="image/r5.gif" width="5" height="1" border="0"></TD>
</TR>
</TABLE>
</DIV>
<P class="mini">MR, Кузнецов Алексей КТ-503, РГППУ, 2007г.</P>
<!--содержание к-->
		</TD>
	</TR>
	</TABLE>
	<!--часть содержания к-->
	</TD>
</TR>
<TR>
</TR>
</TABLE>
</BODY>
</HTML>