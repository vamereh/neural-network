<HTML>
<HEAD>
<TITLE>Камера</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=windows-1251" />
<LINK rel="stylesheet" href="css\style.css" type="text/css">
<SCRIPT src="script/buttonscript.js" language="JavaScript"></SCRIPT>
</HEAD>
<BODY>
<A name="begin"></A>
<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
<TR>
	<TD colspan="2">
	<!--часть шапка н-->
	<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
	<TR>
		<TD rowspan="2" bgcolor="#3B3B3B">
        	<P class="mainhead">
<!--Основной заголовок н-->
Программирование и внедрение нейросетей
<!--Основной заголовок к-->
			</P>
		</TD>
		<TD bgcolor="#3B3B3B" align="right" valign="top">
		<P class="t2">
<!--в шапке справа вверху н-->
<A href="search.htm" class="help"><IMG src="image/search_b.gif" width="16" height="16" border="0"> Поиск&nbsp;&nbsp;</A>
<A href="help.htm" class="help"><IMG src="image/question_b.gif" width="16" height="16" border="0"> Справка&nbsp;&nbsp;</A>

<!--в шапке справа вверху к-->
		</P>
		</TD>
	</TR>
	<TR>
		<TD bgcolor="#3B3B3B">
			<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
			<TR>
				<TD width="166" height="38"><IMG src="image/1.gif" width="166" height="38" border="0"></TD>
				<TD width="100%" height="38" background="image/2.gif"><IMG src="image/2.gif" width="1" height="38" border="0"></TD>
				<TD width="157" height="38"><IMG src="image/3.gif" width="157" height="38" border="0"></TD>
				<TD bgcolor="#6A6A6A">
					<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
					<TR>
						<TD width="100%" height="100%">
<!--в шапке маленькая надпись с права внизу н-->
<P class="t1">РГППУ</P>
<!--в шапке маленькая надпись с права внизу к-->
						<TD>
					</TR>
					<TR><TD width="100%" height="1" bgcolor="#3B3B3B"><IMG src="image/r1.gif" width="1" height="1" border="0"><TD></TR>
					</TABLE>
				</TD>
			</TR>
			</TABLE>
		</TD>
	</TR>
	<TR>
		<TD colspan="2" bgcolor="#626262"><IMG src="image/r2.gif" width="1" height="16" border="0"></TD>
	<TR>
	</TABLE>
	<!--часть шапка к-->
	</TD>
</TR>
<TR>
	<TD width="*" height="100%" bgcolor="#DFEDF6">
	<!--часть навигация н-->
	<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">

	<TR>
		<TD width="181" height="30"><IMG src="image/r3.gif" width="1" height="30" border="0"></TD>
		<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
	</TR>
<!--кнопки н-->
<!--
<TR>
	<TD width="181" height="30" background="image\b.gif" align="right" valign="middle">
	<P class="button_on"><NOBR>Начало</NOBR></P>
	</TD>
	<TD width="1" height="30" bgcolor="#FFFFFF"><IMG src="image/r5.gif" width="1" height="1" border="0"></TD>
</TR>
-->

<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="start.htm"><NOBR>Начало</NOBR></A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="create_proj.htm"><NOBR>Создание окна</NOBR></A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="cr_neronet.htm"><NOBR>Создание нейросети</NOBR></A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="initd3d.htm"><NOBR>Запуск Direct3D</NOBR></A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="crdelmod.htm"><NOBR>Визуализация</NOBR></A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="anim.htm">Анимация</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" background="image\b.gif" align="right" valign="middle">
	<P class="button_on"><NOBR>Камера</NOBR></P>
	</TD>
	<TD width="1" height="30" bgcolor="#FFFFFF"><IMG src="image/r5.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="bma.htm">ВМА-файл</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="frommaxtox.htm">Экспорт модели</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="impl_neronet.htm">Внедрение нейросети</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle">
	<P class="button_on">&nbsp;</P>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="use_books.htm">Литература</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="ip.htm">Интерфейс пособия</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="metodukaz.htm">Методические указания</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>
<TR>
	<TD width="181" height="30" align="right" valign="middle" onmouseover="bgimageon(this)" onmouseout="bgimageof(this)">
	<A href="search.htm">Поиск по пособию</A>
	</TD>
	<TD width="1" height="30" bgcolor="#90B2D9"><IMG src="image/r4.gif" width="1" height="1" border="0"></TD>
</TR>

<!--кнопки к-->
	<TR>
		<TD width="181" height="100%"><IMG src="image/r3.gif" width="1" height="1" border="0"></TD>
		<TD width="1" height="100%"  bgcolor="#DFEDF6" valign="top"><IMG src="image/9.gif" width="1" height="161" border="0"></TD>
	</TR>
	<TR>
		<TD width="182" height="1"><IMG src="image/r3.gif" width="182" height="1" border="0"></TD>
	</TR>
	</TABLE>
	<!--часть навигация к-->
	</TD>
	<TD width="100%" height="100%">
	<!--часть содержания н-->
	<TABLE cellspacing="0" cellpadding="0" border="0" width="100%" height="100%" align="center">
	<TR>
		<TD align="justify" valign="top">
<!--содержание н-->

<DIV class="layer_window">
<TABLE cellspacing="0" cellpadding="0" border="0" width="*" height="*" align="center" >
<TR>
	<TD width="5" height="23"><IMG src="image/5.gif" width="5" height="23" border="0"></TD>
	<TD width="*" height="23" background="image/4.gif">
		<TABLE cellspacing="0" cellpadding="0" border="0" width="*" height="*" align="center" >
		<TR>
			<TD width="100%" height="23" align="justify" valign="middle" >
<P class="head_window">Камера</P>
			</TD>
			<TD width="63" height="23"><IMG src="image/mini_b.gif" width="63" height="23" border="0"></TD>
		</TR>
		</TABLE>
	</TD>
	<TD width="5" height="23"><IMG src="image/6.gif" width="5" height="23" border="0"></TD>
<TR>
<TR>
	<TD width="5" height="44" valign="bottom"><IMG src="image/7.gif" width="5" height="44" border="0"></TD>
	<TD height="100%" align="justify" valign="top">
<!--текст окошка н-->



<P class="title">Лабораторная работа №6</P>

<P class="title3">КАМЕРА</P>

<P class="title2">В этой лабораторной работе вы научитесь:</P>
<P class="text">
1.	Программировать по средствам DirexctX API точку наблюдения за сценой (камеру).
<BR>2.	Создавать и применять матрицу вида.
<BR>3.	Использовать полярные координаты.
 
<P class="title2">1. Обзор API-функций для работы с камерой</P>
<P class="text">
Для работы с камерой не было созданно ни одного класса. «Почему» - спросите вы? Все дело в том, что для 
этого достаточно знать всего две API функции DirectX: D3DXMatrixLookAtLH и SetTransform. Вы их уже 
использовали, но подробно не рассматривали. Сейчас пришло время изучить их подробнее.

<P class="text">В DirectX существует понятие "матрица вида". Матрица вида определяет местоположение точки обзора (камеры) 
сцены и может состоять из любых комбинаций трансляции (перемещения) и вращения. Изначально камера находиться 
в начале системы координат (0, 0, 0) и направлена в положительную сторону оси Z, а матрица вида перемещает 
объекты сцены вокруг позиции камеры.
 
<P class="text">С помощью функции D3DXMatrixLookAtLH (out, eye, at, up) в Direct3D 
создается матрица вида, где out – итоговая матрица всей операции, а значения eye, at, и up задаются при 
помощи структуры D3DXVECTOR3, описывающей точку в пространстве посредствам задания трех координат по 
осям X, Y, Z.
<BR>Значение eye – это место нахождение камеры.
<BR>Значение at – это та точка, куда камера направлена.  
<BR>Значение up – то, что видим в итоге. Его нужно задавать таким образом: &D3DXVECTOR3(0.0f, 0.0f, 1.0f).
<BR>D3DXVECTOR3 – это функция, которая возвращает значение D3DXVECTOR3, а в скобках 
указывается x, y, z, т.е. однозначное местоположение. 
<BR>& - как вам должно быть известно, этот оператор служит для получения адреса на данные.

<P class="text">После создания матрицы вида вы должны сообщить устройству воспроизведения (видеокарте) данные содержащиеся 
в матрице вида. Для этого применяется метод устройства воспроизведения SetTransform (D3DTS_VIEW, &out), где D3DTS_VIEW
- это флаг, указывающий что сейчас будет передаваться данные о матрице вида, а &out - это ссылка на данные, 
хранящиеся в матрице вида.<BR>
Функция SetTransform устройства воспроизведения предназначена для отправки данных о матрице вида на видеокарту.
Она имеет два входных параметра: первый - тип матрицы (в нашем случае "матрица вида" = D3DTS_VIEW), второй - 
сама матрица, а вернее ссылка на неё.

<P class="title2">2. Применение API-функций для работы с камерой</P>
<P class="text">
Как вы помните в своих проектах вы уже имеете конструкцию связанную с камерой:
</P>
<P class="kod">
D3DXMATRIX matView;
<BR>D3DXMatrixLookAtLH(&matView, &D3DXVECTOR3(500, 500, 500), &D3DXVECTOR3(0, 0, 0), &D3DXVECTOR3(0.0f, 0.0f, 1.0f));
<BR>D3DDevice->SetTransform(D3DTS_VIEW, &matView);

<P class="text">
D3DXMATRIX matView; - это ничто иное как матрица вида. Камера находиться в точке с координатами x=500, y=500, 
z=500 и направлена в точку с координатами x=0, y=0, z=0.<BR>
Сейчас попробуйте привязать камеру к кнопкам управления. Нужно сделать так, чтобы не модель вращалась 
(как это сейчас) вокруг своей оси перед наблюдающим, а чтобы камера изменяла свое местоположение.<BR>

<P class="text2">
<B>Задание 1</B><BR>
Откройте свой проект, сделанный в прошлой главе данного пособия.

<P class="text2">
<B>Задание 2</B><BR>
Для этого сотрите код, который изменял угол поворота модели: 
<P class="kod">
if (Model3D->rotate<=359) {Model3D->rotate+=1;}<BR>
else {Model3D->rotate = 0;};

<P class="text2">
<B>Задание 3</B><BR>
Далее, введите глобальную переменную (эту переменную стоит описать в том же месте, где создавались гл. объект и объект видеокарты) 
ang_cam типа float и тут же инициализируйте её значением 0.0f .

<P class="text2">
<B>Задание 4</B><BR>
Затем в функции MainWinProc, в разделе, где вы обрабатываете сообщение о нажатии кнопки, напишите код
обработки нажатия клавиш "стрелка влево" и "стрелка вправо", в котором при нажатии на клавишу "стрелка влево"
ang_cam увеличивается на 10 градусов, а при нажатии на клавишу "стрелка вправо" - уменьшается:
<P class="kod">
if (wparam == VK_LEFT)<BR> 
{	<BR>		
&nbsp;&nbsp;if (ang_cam<350) {ang_cam+=10.0f;} else {ang_cam=0.0f;};<BR>
};<BR><BR>
if (wparam == VK_RIGHT) <BR>
{		<BR>	
&nbsp;&nbsp;if (ang_cam>0) {ang_cam-=10.0f;} else {ang_cam=350.0f;};<BR>
};<BR>

<P class="text">
Описанную выше конструкцию вы применяли не раз, поэтому и объяснять особо тут уже нечего. В данном выше коде не должно быть 
ничего непонятного. Если все же есть что-то непонятное, то пересмотрите предыдущие лабораторнае работы данного пособия.<BR>
Теперь, перепишите код для получения матрицы вида. Для этого придеться использовать полярные координаты, которые гласят, 
что координаты точки в пространстве можно определить, зная угол и расстояние до неё от начала координат. 

<P class="text2">
<B>Задание 5</B><BR>
Измените входные параметры функции D3DXMatrixLookAtLH, которые отвечают за месторасположения камеры, вот так:
<P class="kod">
//вместо &D3DXVECTOR3(500, 500, 500)<BR>
&D3DXVECTOR3(500*cos(D3DXToRadian(ang_cam)), 500*sin(D3DXToRadian(ang_cam)), 500)
<P class="text2">
где D3DXToRadian функция перевода градусов в радианы.

<P class="text">
Вот и все... 

<P class="text2">
<B>Задание 6</B><BR>
Откомпилируйте проект и запустите исполняемый файл. Сейчас появилась возможность двигать камеру вокруг 
робо-паука. 

<P class="text2">
<B>Задание 7</B><BR>
Если по какой то причине ваш проект не работает можете скачать готовый 
<A href="files\kamera.zip" class="wt">здесь</A>
 и найти свою ошибку.

<P class="title2">Вопросы для  самоконтроля</P>
<P class="text">
1)	Что определяет матрица вида?
<BR>2)	С помощью какой функции можно сделать матрицу вида?
<BR>3)	Какие параметры нужно передать в функцию, которая создает матрицу вида?
<BR>4)	Зачем нужна функция SetTransform?

</P>



<!--текст окошка к-->
	<P align="right"><A href="#begin" class="wt">наверх</A></P><BR>
	</TD>
	<TD width="5" height="44" valign="bottom"><IMG src="image/8.gif" width="5" height="44" border="0"></TD>
</TR>
<TR>
	<TD width="5" height="1"><IMG src="image/r5.gif" width="5" height="1" border="0"></TD>
	<TD width="*" height="1" bgcolor="#CFDDF2"><IMG src="image/r6.gif" width="1" height="1" border="0"></TD>
	<TD width="5" height="1"><IMG src="image/r5.gif" width="5" height="1" border="0"></TD>
</TR>
</TABLE>
</DIV>
<P class="mini">MR, Кузнецов Алексей КТ-503, РГППУ, 2007г.</P>
<!--содержание к-->
		</TD>
	</TR>
	</TABLE>
	<!--часть содержания к-->
	</TD>
</TR>
<TR>
</TR>
</TABLE>
</BODY>
</HTML>